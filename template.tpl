___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Cliengo",
  "categories": ["CHAT", "MARKETING", "SALES"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Instala el widget de Cliengo y comienza a convertir tus visitas en clientes.\n\nInstall Cliengo\u0027s widget and start converting your visits to leads.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "chatbotToken",
    "displayName": "Chatbot token",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^[a-f\\d]{24}-[a-f\\d]{24}$"
        ],
        "errorMessage": "Introduce un chatbot token válido"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Introduzca aquí su código de plantilla.
const log = require('logToConsole');
const injectScript = require('injectScript');
const queryPermission = require('queryPermission');

// Build chatbotToken and url
const chatbotToken = data.chatbotToken.replace("-","/");
const url = "https://s.cliengo.com/weboptimizer/".concat(chatbotToken).concat(".js");

// If the script loaded successfully, log a message and signal success
 const onSuccess = () => {
  log('Cliengo: Script instalado exitosamente.');
  data.gtmOnSuccess();
 };

// If the script fails to load, log a message and signal failure
 const onFailure = () => {
  log('Cliengo: Hubo un error en la instalación de script.');
  data.gtmOnFailure();
 };

log('Cliengo: Cargando script desde ' + url);

// Exectute injectScript if Permissions are OK, else execute gtmOnFailure
if (queryPermission('inject_script', url)) {
  log("Cliengo: Pegando script.");
  injectScript(url, onSuccess, onFailure);
} else {
  log('Cliengo: Hubo un error de permisos.');
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.cliengo.com/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: test
  code: |-
    const mockData = {
      ola: "chau"
      // Mocked field values
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();


___NOTES___

Created on 2/2/2021 16:21:39


